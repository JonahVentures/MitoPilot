<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>NMNH Hydra • MitoPilot</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="NMNH Hydra">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MitoPilot</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/JonahVentures/MitoPilot/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>NMNH Hydra</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/JonahVentures/MitoPilot/blob/main/vignettes/NMNH-Hydra.Rmd" class="external-link"><code>vignettes/NMNH-Hydra.Rmd</code></a></small>
      <div class="d-none name"><code>NMNH-Hydra.Rmd</code></div>
    </div>

    
    
<style>
.alert {
  border-left: 5px solid;
  padding: 10px;
  margin: 10px 0;
  border-radius: 5px;
}
.alert-tip { border-color: #28A745; background-color: #E9F7EF; }
.alert-note { border-color: #007BFF; background-color: #EBF5FF; }
.alert-warning { border-color: #FFC107; background-color: #FFF9E6; }
.alert-danger { border-color: #DC3545; background-color: #F8D7DA; }
strong { font-weight: bold; }
</style>
<div class="section level2">
<h2 id="how-to-use-mitopilot-on-the-smithsonian-hydra-computing-cluster">How to use MitoPilot on the Smithsonian Hydra computing cluster<a class="anchor" aria-label="anchor" href="#how-to-use-mitopilot-on-the-smithsonian-hydra-computing-cluster"></a>
</h2>
<p>You will need an account to access the Hyrda computing cluster.
Instructions are available <a href="https://confluence.si.edu/display/HPC/Hydra+Policies" class="external-link">here</a>.</p>
<div class="section level3">
<h3 id="first-time-setup">First time setup<a class="anchor" aria-label="anchor" href="#first-time-setup"></a>
</h3>
<p>Dan MacGuigan has submitted a request to the Hydra team for
installation of a Nextflow module. But for now, you will need to install
your own copy of Nextflow on the cluster. Login to Hydra and run the
following.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Nextflow installation instructions</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="co"># from https://www.nextflow.io/docs/latest/install.html</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="bu">cd</span> ~</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="ex">module</span> load tools/java/21.0.2</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-s</span> https://get.nextflow.io <span class="kw">|</span> <span class="fu">bash</span> <span class="co"># install Nextflow</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">chmod</span> +x nextflow <span class="co"># make Nextflow executable</span></span></code></pre></div>
<p>There will now be an executable <code>nextflow</code> file in your
home directory. You should move it to a location that is in your
<code>PATH</code>. For example:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">mkdir</span> ~/bin <span class="co"># create bin directory, if needed</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">mv</span> ~/nextflow ~/bin/nextflow <span class="co"># move nextflow to bin directory</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="bu">echo</span> <span class="st">'export PATH="${HOME}/bin:${PATH}"'</span> <span class="op">&gt;&gt;</span> ~/.bashrc <span class="co"># add bin directory to PATH, in case it's not already there</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="bu">source</span> ~/.bashrc</span></code></pre></div>
<p>This should allow you to call <code>nextflow</code> from anywhere on
the cluster.</p>
<div class="alert alert-note">
<p><strong>Note:</strong> You must load the Hydra Java module
(<code>module load tools/java/21.0.2</code>) whenever you wish to use
Nextflow.</p>
</div>
</div>
<div class="section level3">
<h3 id="launching-rstudio-server">Launching RStudio server<a class="anchor" aria-label="anchor" href="#launching-rstudio-server"></a>
</h3>
<p>Next, let’s launch RStudio server, which we’ll use to install and run
MitoPilot.</p>
<ul>
<li>login to Hydra</li>
<li>run <code>conda deactivate</code> to avoid package conflicts (may
not be necessary for all users)</li>
<li>run <code>module load tools/R/RStudio/server</code>
</li>
<li>run <code>start-rstudio-server</code> (you may be asked to run a
different command if this is your first time)</li>
<li>leave this cluster terminal window open</li>
<li>in a new terminal window on your local computer:
<ul>
<li>start an ssh tunnel by running something like
<code>ssh -N -L 8787:compute-64-16:8787 sylvain@hydra-login01.si.edu</code>
<ul>
<li>the exact command should have been printed by
<code>start-rstudio-server</code> in your cluster terminal window</li>
</ul>
</li>
<li>leave this local terminal window open</li>
<li>open a web browser and enter <code>http://localhost:8787</code> in
the URL bar</li>
<li>enter your cluster login credentials to access the RStudio
server</li>
<li>any commands run in this new window will execute on the cluster in
the interactive session</li>
</ul>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="installing-mitopilot">Installing MitoPilot<a class="anchor" aria-label="anchor" href="#installing-mitopilot"></a>
</h3>
<p>To install MitoPilot, use the RStudio server window to run the
following. This might take a while.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"BiocManager"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"BiocManager"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="st">"JonahVentures/MitoPilot"</span><span class="op">)</span></span></code></pre></div>
<p>If the installation was successful, you’re ready to start using
MitoPilot!</p>
</div>
<div class="section level3">
<h3 id="launching-mitopilot">Launching MitoPilot<a class="anchor" aria-label="anchor" href="#launching-mitopilot"></a>
</h3>
<p>We recommend running MitoPilot within an interactive session on the
cluster to avoid unnecessary computational burden on the login nodes.
First, initialize an interactive session on Hydra.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">qrsh</span> <span class="at">-l</span> h_rt=24:00:00 </span></code></pre></div>
<p>Note that interactive sessions can run for a maximum of 24 hours.
Additionally, users are limited to one active interactive session at a
time.</p>
<p>Once the interactive session starts, you can launch RStudio
server.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">conda</span> deactivate</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="ex">module</span> load tools/R/RStudio/server tools/java/21.0.2</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="ex">start-rstudio-server</span></span></code></pre></div>
<p>Follow the login instructions as presented above. Once you have an
Rstudio server window open, run <code><a href="https://github.com/JonahVentures/MitoPilot" class="external-link">library(MitoPilot)</a></code> to load
the package.</p>
<p>If you need to update MitoPilot, simply run the BiocManager
installation command again. If you would like to ensure that you’re
using the latest MitoPilot version, run
<code>remove.packages("MitoPilot")</code> prior to installation.</p>
<p>Want to learn how to use MitoPilot? Check out the <a href="https://jonahventures.github.io/MitoPilot/articles/test-project.html">Test
Project Tutorial</a>.</p>
</div>
<div class="section level3">
<h3 id="running-large-mitopilot-jobs">Running Large MitoPilot Jobs<a class="anchor" aria-label="anchor" href="#running-large-mitopilot-jobs"></a>
</h3>
<p>If you have a large number of samples to process (more than a few
dozen), we recommend running the assemble and annotate MitoPilot modules
as batch jobs.</p>
<p>Running these modules within the R Shiny GUI requires you to maintain
an open connection to the cluster. There may be issues restarting if the
connection breaks while Nextflow is running. Instead, we can “fire and
forget” by submitting batch jobs.</p>
<p>First, initialize your new project and modify any desired parameters
using the GUI. Once ready, click <code>UPDATE</code>. A new window
should appear.</p>
<p><img src="figures%2Ftest-project%2F8.png"></p>
<p>Rather than clicking the <code>Start Nextflow</code> button, copy the
Nextflow command and create a submission script. We have provided a
template below. You may wish to modify the job name (<code>-N</code>)
and the log file name (<code>-o</code>).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co">#!/bin/sh</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co">#$ -N MitoPilot_assembly # MODIFY THIS IF DESIRED</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">#$ -o MitoPilot_assembly.log # MODIFY THIS IF DESIRED</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">#$ -cwd -j y</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co">#$ -q lTWFM.sq</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#$ -l wfmq</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#$ -S /bin/sh</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="bu">echo</span> + <span class="kw">`</span><span class="fu">date</span><span class="kw">`</span> job <span class="va">$JOB_NAME</span> started in <span class="va">$QUEUE</span> with jobID=<span class="va">$JOB_ID</span> on <span class="va">$HOSTNAME</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="bu">source</span> ~/.bashrc</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="ex">module</span> load tools/java/21.0.2 <span class="co"># required for Nextflow on Hydra</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co"># NEXTFLOW COMMAND, example below</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="ex">nextflow</span> <span class="at">-log</span> /pool/public/genomics/macguigand/MitoPilot/22030FL-06-02/run_02/.logs/nextflow.log run /home/macguigand/R/x86_64-pc-linux-gnu-library/4.4/MitoPilot/nextflow <span class="at">-c</span> /pool/public/genomics/macguigand/MitoPilot/22030FL-06-02/run_02/.config <span class="at">-entry</span> WF1</span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a><span class="bu">echo</span> = <span class="kw">`</span><span class="fu">date</span><span class="kw">`</span> job <span class="va">$JOB_NAME</span> done</span></code></pre></div>
<div class="alert alert-warning">
<p><strong>Warning:</strong> You must use the options
<code>-q lTWFM.sq</code> and <code>-l wfmq</code>. This is a special
Hydra queue for workflow managers like Nextflow. Nextflow will not work
in other queues.</p>
</div>
<p>Move the submission script into your MitoPilot run directory (in the
above example,
<code>/pool/public/genomics/macguigand/MitoPilot/22030FL-06-02/run_02/</code>).
Then submit the job using <code>qsub MY_SCRIPT_NAME.sh</code>.</p>
<p>You can monitor the progress of this job using the <code>qstat</code>
command and by checking on the log files. Once the job is done, you can
relaunch the GUI to inspect the results. The same approach can be used
for the annotate module.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Devin Leopold.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
